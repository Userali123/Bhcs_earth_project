<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Earth 3D Viewer</title>
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
  <style>
    html, body, #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: black;
    }

    #toolbar {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1;
      background-color: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 8px;
    }

    #searchInput {
      width: 200px;
      padding: 5px;
      font-size: 14px;
      border-radius: 4px;
      border: none;
    }

    #searchBtn {
      padding: 5px 10px;
      border-radius: 4px;
      border: none;
      background-color: orange;
      color: white;
      cursor: pointer;
    }

    #searchBtn:hover {
      background-color: #ff6600;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>

  <div id="toolbar">
    <input type="text" id="searchInput" placeholder="Search for a place..." />
    <button id="searchBtn">Search</button>
  </div>

  <script>
    // Replace with your actual Cesium Ion access token
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI4YTBkMTYyOS0zOGU0LTQ2ZGYtYTIxNi0zOWI2MDlkY2MwMjkiLCJpZCI6MzAwOTU4LCJpYXQiOjE3NDY3ODMwNTl9.ap2QOeUQBh8GN91i_3j5nb1G60Zwu4vCmi3Cf7wqUa4';

    const viewer = new Cesium.Viewer('cesiumContainer', {
      terrain: Cesium.Terrain.fromWorldTerrain(),
      shouldAnimate: true,
      timeline: true,
      animation: true,
      geocoder: false, // Weâ€™ll use our own search
      sceneModePicker: true,
      baseLayerPicker: true,
      navigationHelpButton: true,
      homeButton: true,
      infoBox: true,
      selectionIndicator: true
    });

    viewer.scene.globe.enableLighting = true;

    // Search function using OpenCage API (free & easy)
    async function searchPlace(placeName) {
      const apiKey = 'fd3690c0823849bb9d62f1bde3b3f81a'; // public OpenCage key
      const url = `https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(placeName)}&key=${apiKey}`;

      try {
        const response = await fetch(url);
        const data = await response.json();

        if (data.results.length > 0) {
          const result = data.results[0];
          const lat = result.geometry.lat;
          const lng = result.geometry.lng;

          viewer.camera.flyTo({
            destination: Cesium.Cartesian3.fromDegrees(lng, lat, 1500000),
            duration: 2
          });

          viewer.entities.add({
            name: result.formatted,
            position: Cesium.Cartesian3.fromDegrees(lng, lat),
            point: {
              pixelSize: 10,
              color: Cesium.Color.YELLOW
            },
            description: `<h3>${result.formatted}</h3><p>Lat: ${lat}<br>Lon: ${lng}</p>`
          });
        } else {
          alert('Location not found.');
        }
      } catch (error) {
        console.error('Search error:', error);
        alert('Error searching location.');
      }
    }

    document.getElementById('searchBtn').addEventListener('click', () => {
      const place = document.getElementById('searchInput').value;
      if (place.trim()) {
        searchPlace(place);
      }
    });

    // Optional: Click to display lat/lon
    const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
    handler.setInputAction(function(click) {
      const pickedPosition = viewer.scene.pickPosition(click.position);
      if (Cesium.defined(pickedPosition)) {
        const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(pickedPosition);
        const lat = Cesium.Math.toDegrees(carto.latitude).toFixed(4);
        const lon = Cesium.Math.toDegrees(carto.longitude).toFixed(4);
        alert(`You clicked on:\nLatitude: ${lat}\nLongitude: ${lon}`);
      }
    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);
  </script>
</body>
</html>
